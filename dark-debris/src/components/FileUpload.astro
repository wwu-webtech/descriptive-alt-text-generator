---
import {fileFromPath} from 'openai'
import Metadata from './Metadata.astro'

// gets fileName
const handleFileSelect = (event) => {
  const fileName = event.target.files[0]?.name || 'None';
  document.dispatchEvent(new CustomEvent('fileSelected', { detail: fileName }));
};
---

<astro-upload>
	<div class="wwu-card horizontal dark-blue-bg">
		<div class="body">
			<form id="file-upload-form">
				<label for="		"><h3>Name of File, please.</h3></label>
				<input type="file" id="file-input" accept=".png,.jpg,.jpeg,.webp"/>

				<!-- Expandable section for advanced options: Contains two submenus currently: character limit, and other -->
				<h3>Advanced Options</h3>
				<details id="advanced-options">
					<summary>A place for individuals to store their individual settings.</summary>

					<!-- Expandable section for character limit settings -->
					<details id="character-limit" open>
						<summary>Character Limit</summary>
						<div class="radio">
							<input
								type="radio"
								id="limit-response-140"
								name="limit"
								value="140"
								checked
							/>
							<label for="limit-response-140">
								Limit responses to under 140 characters.
							</label>
						</div>
						<div class="radio">
							<input
								type="radio"
								id="limit-response-280"
								name="limit"
								value="280"
							/><label for="limit-response-280">
							Limit responses to under 280 characters.
						</label>
						</div>
						<div class="radio">
							<input
								type="radio"
								id="limit-response-none"
								name="limit"
								value="no-limit"
							/>
							<label for="limit-response-none">
								No character limit.
							</label>
						</div>
					</details>


					<!-- Expandable section for other options -->
					<details id="other-options">
						<summary>Other</summary>

						<div class="checkbox">
							<input type="checkbox" id="show-metadata" name="show-metadata" checked="checked"/>
							<label for="show-metadata">Enable the download of metadata button</label>
						</div>
					</details>
				</details>
			</form>

			<button id="evaluate-image">Evaluate Selected Image</button>
		</div>
		<div class="image-area">
			<div class="image-area-content">
				<canvas id="canvas" aria-label=""></canvas>

				<div class="bottom-right-metadata">
					<Metadata/>
				</div>
			</div>
		</div>
	</div>
</astro-upload>

<!--Listener for fileName change from 'None' -->
<script type="module">
	const fileInput = document.querySelector('#file-input');
	fileInput.addEventListener('change', (event) => {
	  const fileName = event.target.files[0]?.name || 'None';
	  document.dispatchEvent(new CustomEvent('fileSelected', { detail: fileName }));
	});
  </script>

<script>
	class AstroUpload extends HTMLElement {
		constructor() {
			super();
		}
	}

	customElements.define("astro-upload", AstroUpload);
</script>


<script src="../js/UploadHelper.js"></script>
